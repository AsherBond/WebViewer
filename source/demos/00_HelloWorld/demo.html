<!--
      This is a minimal application using the cwc WebGL Engine
      Tutorial 2: Using internal shaders to simplify the application
-->
<!DOCTYPE html>
<html lang="en">
   <head>
      <script type="text/javascript" src="../../core/openwebglobe.js"></script>
      <script type="text/javascript" src="../../core/shaders.js"></script>
      <script type="text/javascript" src="../../core/vec4.js"></script>
      <script type="text/javascript" src="../../core/mat4.js"></script>
      <script type="text/javascript" src="../../core/vec3.js"></script>
      <script type="text/javascript" src="../../core/mesh.js"></script>
      <script type="text/javascript">
         
         //---------------------------------------------------------------------
         
         var totaltime = 0;
         var engine = null;
         var cube = null;
         
         //---------------------------------------------------------------------
         
         function OnTimer(delta)
         {
            totaltime = totaltime + delta;
            
            if (totaltime > 1000) // change background color every second (1000 milliseconds)
            {
               var r=Math.abs(Math.random());
               var g=Math.abs(Math.random());
               var b=Math.abs(Math.random());
               engine.SetClearColor(r,g,b,1);
               totaltime = 0;
            }
         }
         
         //---------------------------------------------------------------------
         
         function OnResize(w,h)
         {
            console.log("Resize: " + w + ", " + h);
         }
         
         //---------------------------------------------------------------------
         
         function OnRender()
         {
            // engine.DrawCube()
         /*   projection = new mat4();
            fovy = 45; 
            aspect = engine.width / engine.height;
            projection.Perspective(fovy, aspect, 0.001, 1000);
            
            rotation = 1;//rotation + nMSeconds/1000;
            
             
            model = new mat4();
            //model.Translation(0,0,-50);
            
            view = new mat4();
            view.RotationX(rotation);
            
            modelview = new mat4();
            modelview.Multiply(model, view);
            */
            mvp = new mat4();  
          //  mvp.Multiply(modelview, projection);
            
            //mat.Zero();
            //console.log(mat.ToString());
            if(cube.Ready)
            {
               cube.SetModelViewProjection(mvp);
               cube.Draw();    
            }
         }
         
         //---------------------------------------------------------------------
         
         function OnInit()
         {
              //--------------------------------------------------
              // CUBE
              //--------------------------------------------------
              /*
               var vertices = [
                   // position XYZ, color RGBA => 7 floats per vertex
                   -0.5,   0.5,  -0.5,  1.0,  0.0,  0.0,  1.0,
                    0.5,   0.5,  -0.5,  0.0,  1.0,  0.0,  1.0,
                   -0.5,  -0.5,  -0.5,  0.0,  0.0,  1.0,  1.0,
                    0.5,  -0.5,  -0.5,  1.0,  1.0,  0.0,  1.0,
                    0.5,  -0.5,   0.5,  1.0,  0.0,  1.0,  1.0,
                    0.5,   0.5,   0.5,  0.0,  0.0,  1.0,  1.0,
                   -0.5,   0.5,   0.5,  1.0,  1.0,  1.0,  1.0,
                   -0.5,  -0.5,   0.5,  0.0,  0.0,  0.0,  1.0,
               ];
               
               var indices = [ 0, 1, 2, 1, 2, 3, 1, 3, 4, 1, 5, 4, 0, 1, 6, 1, 5, 6, 5, 6, 7, 4, 5, 7, 0, 6, 7, 0, 2, 7, 2, 3, 7, 3, 4, 7];
               */
               cube = new Mesh(engine);
               cube.SetJSONLoadCallback(cbfCubeLoaded);
               cube.loadFromJSON("../../tests/00_JSONDemoFiles/cubeP.json");
               /*
               cube.Create(8);
               cube.SetBufferPC(vertices);
               cube.SetIndexBuffer(indices,"TRIANGLES");*/
           
         }
         
         function cbfCubeLoaded()
         {
            cube.ToGPU();
         }
        
         //---------------------------------------------------------------------
         
         function init()
         {
         	engine = new engine3d();
           
            // Set Callbacks:
            engine.SetInitCallback(OnInit);
            engine.SetTimerCallback(OnTimer);
            engine.SetRenderCallback(OnRender);
            engine.SetResizeCallback(OnResize);
            
            // Start engine...
            engine.InitEngine("canvas", true);  // (canvasid, fullscreen)
       
         }
         
         //---------------------------------------------------------------------
         
      </script>
    </head>
    <body onload="init()">
        <div style="text-align: center">
            <canvas id="canvas" width="640" height="480"></canvas>
        </div>
    </body>
</html>
